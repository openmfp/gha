name: "Update License Metadata"

on:
  workflow_call:
    secrets:
      # This access token requires inter-repository access, so it cannot be the default GITHUB_TOKEN
      GH_ACCESS_TOKEN:
        required: true

jobs:
  create_metadata_proposal:
    runs-on: ubuntu-latest
    name: "Metadata Creation Tool"
    steps:
      - uses: actions/checkout@v4
      # - uses: SAP/metadata-creation-tool-for-reuse@main
      #   with:
      #     repository_url: "${{ github.server_url }}/${{ github.repository }}"
      #     access_token: "${{ secrets.GH_ACCESS_TOKEN }}"
      #     copyright_owner: "(20xx-)20xx SAP SE or an SAP affiliate company and openMFP contributors"
      #     upstream_contact: ""
      - name: Setup GitHub CLI
        run: |
          gh auth login --with-token <<< "${{ secrets.GH_ACCESS_TOKEN }}"

      - name: Check for changes and create pull request
        run: |
          git fetch
          if ! git diff --quiet origin/main..origin/reuse-metadata-proposal; then
            gh pr create --title "License File Update" --body "Auto-generated PR to update License Information" --base origin/main --head origin/reuse-metadata-proposal --repo ${{ github.repository }}
          fi
        env:
          GH_TOKEN: ${{ secrets.GH_ACCESS_TOKEN }}